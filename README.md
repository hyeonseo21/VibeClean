📌 VibeClean Backend Development Log

본 문서는 **VibeClean 프로젝트 백엔드 개발 진행 상황**을 날짜별로 정리한 기록입니다.
API 구현, 통신 프로토콜 전환, STM32 연동, 브랜치 전략 등 실제 개발 흐름을 중심으로 기술합니다.


### 🔹 2024.11.07

* API 명세서 **1번부터 5번까지 기본 동작 구현 완료**
* 현재까지는 Postman을 통한 API 호출 기반 테스트 가능
* **STM32와 직접 통신하는 MQTT 코드 미구현 상태**

  * 백엔드: MQTT 프로토콜 코드 추가 필요
  * STM32: Wi-Fi 모듈 설정 및 MQTT 설정 코드 작성 필요
* `main`에 저장된 **VibeClean 코드가 해당 역할을 임시 수행 중**

---

### 🔹 2024.11.08

* Postman 기반 통신에서 벗어나
  **Mosquitto Broker를 이용한 MQTT 기반 데이터 수신 구조로 전환**
* 수신된 MQTT 데이터를 **즉시 대응 테이블에 저장하도록 변경**
* 이를 위해 다음 작업 수행:

  * `application.yml` 설정 추가
  * `build.gradle`에 MQTT 관련 의존성 추가
  * 환경 변수 설정
  * MQTT 전용 **설정 클래스 및 서비스 계층 분리**
* 기존 API 구조 개선

  * `datetime` 컬럼 추가
  * 센서 값 타입을 `int → double`로 변경
* 해당 변경 사항은 **`master` 브랜치에 반영**

---

### 🔹 2024.11.09

* **3초 동안 신호 미수신 시**

  * `sensor`, `status` 테이블 자동 초기화
  * 해당 메서드는 **1초 주기로 실행**
* 누적 **Total Runtime 계산 로직 구현**
* GET API 개선

  * 데이터가 없을 경우 **기본값 반환**하도록 수정
* POST API 개선

  * 값 수신 시 **즉시 STM32로 publish**하도록 서비스 계층에 로직 추가 예정
* API 명세 정리

  * 타입 통일
  * 변수명 일관성 확보
  * Request / Response 구조 명세에 맞게 수정
  * Postman으로 전면 테스트 완료
* Git & GitHub 관리 체계 정리 및 적용

  * `main` : 최종 완성 백엔드 코드
  * `master` : 현재까지 안정화된 개발 결과
  * `work` : 일일 개발 브랜치
* 백엔드 개발은 **해당 시점 기준으로 대부분 완료**
* 향후 계획

  * **11/10** : STM32 Wi-Fi 모듈 설정
  * **11/11** : STM32 MQTT publish / subscribe 코드 작성

---

### 🔹 2024.11.13

* STM32 측 MQTT 연동 시도

  * **ESP 펌웨어 버전 이슈로 AT 명령어 미지원**
  * 플래시 업데이트 및 경량 MQTT 라이브러리 도입 모두 현실적으로 어려움
* **MQTT → HTTP 프로토콜로 전환 결정**
* 제한된 시간 내(오후 1시 등교 전)

  * HTTP 기반 통신 코드 작성 필요

---

### 🔹 2024.11.15

* HTTP 통신 기반으로 **전체 기능 재구현 완료**

  * 수동 조작 토글
  * 수동 조작 값 전달
* 예외 조건 및 동작 시나리오를 고려하여 안정성 확보
* 테스트 완료
* 상세 내용은 **Notion 문서에 정리**

---

### 🔹 2024.11.17

* API 명세서 **1번에 `mode` 필드 추가**
* 이에 따른 백엔드 코드 수정 및 반영

---

### 🔹 2024.11.19

* `mode` 값을 `status` 테이블에 정식 반영
* **MQTT 최종 구현 완료**

  * 단, 커밋 누락으로 **11월 23일에 커밋됨**

---

### 🔹 2024.12.02

* 보드 2대 사용에 따른 예외 처리

  * 한 쪽에서 전송되는 **더미 publish 값은 저장하지 않도록 로직 추가**
  * 현재는 **주석 처리 상태**

---

### 🔹 2024.12.17

* **2D Mapping 기능을 백엔드 단에서 구현**
* 전체 기능 통합 및 **최종 개발 완료**
